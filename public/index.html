<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Today ‚Äî Stremio Addon</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #06060e;
            --bg-card: #0d0d1a;
            --bg-surface: #13132a;
            --accent: #ff4d6a;
            --accent-glow: rgba(255, 77, 106, 0.3);
            --accent-secondary: #00e5a0;
            --text: #e8e8f0;
            --text-dim: #7a7a9e;
            --border: rgba(255, 255, 255, 0.06);
            --radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg-deep); color: var(--text); min-height: 100vh; overflow-x: hidden; }
        .bg-grid { position: fixed; inset: 0; background-image: linear-gradient(rgba(255,77,106,0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255,77,106,0.03) 1px, transparent 1px); background-size: 60px 60px; pointer-events: none; z-index: 0; }
        .bg-glow { position: fixed; width: 600px; height: 600px; border-radius: 50%; filter: blur(150px); opacity: 0.15; pointer-events: none; z-index: 0; }
        .bg-glow-1 { top: -200px; right: -100px; background: var(--accent); }
        .bg-glow-2 { bottom: -200px; left: -100px; background: var(--accent-secondary); }
        .container { position: relative; z-index: 1; max-width: 960px; margin: 0 auto; padding: 40px 24px; }

        .header { text-align: center; margin-bottom: 60px; }
        .logo-badge { display: inline-flex; align-items: center; gap: 8px; background: var(--bg-surface); border: 1px solid var(--border); border-radius: 100px; padding: 8px 20px; font-size: 13px; font-weight: 500; color: var(--accent); margin-bottom: 24px; letter-spacing: 0.5px; text-transform: uppercase; }
        .logo-badge .dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent-secondary); animation: pulse 2s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        h1 { font-size: clamp(48px, 8vw, 72px); font-weight: 800; line-height: 1; margin-bottom: 16px; letter-spacing: -2px; }
        h1 .accent { color: var(--accent); }
        h1 .green { color: var(--accent-secondary); }
        .tagline { font-size: 18px; color: var(--text-dim); font-weight: 300; max-width: 500px; margin: 0 auto 40px; line-height: 1.6; }
        .install-row { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 16px; }

        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 14px 28px; font-family: 'Outfit', sans-serif; font-size: 15px; font-weight: 600; border: none; border-radius: var(--radius); cursor: pointer; transition: all 0.2s; text-decoration: none; }
        .btn-primary { background: var(--accent); color: white; box-shadow: 0 0 30px var(--accent-glow); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 0 50px var(--accent-glow); }
        .btn-secondary { background: var(--bg-surface); color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { border-color: var(--accent); }
        .btn-small { padding: 10px 18px; font-size: 13px; }
        .btn-danger { background: rgba(255,77,106,0.15); color: var(--accent); border: 1px solid rgba(255,77,106,0.2); }

        .manifest-url { font-family: 'Space Mono', monospace; font-size: 13px; color: var(--text-dim); background: var(--bg-surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 18px; display: inline-flex; align-items: center; gap: 10px; cursor: pointer; transition: border-color 0.2s; }
        .manifest-url:hover { border-color: var(--accent); }

        .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin: 60px 0; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 28px; transition: border-color 0.3s; }
        .card:hover { border-color: rgba(255, 77, 106, 0.2); }
        .card-icon { font-size: 28px; margin-bottom: 16px; }
        .card h3 { font-size: 16px; font-weight: 600; margin-bottom: 8px; }
        .card p { font-size: 14px; color: var(--text-dim); line-height: 1.6; }

        .settings-section { background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); padding: 32px; margin: 40px 0; }
        .settings-section h2 { font-size: 22px; font-weight: 700; margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .settings-section .desc { color: var(--text-dim); font-size: 14px; margin-bottom: 28px; }
        .setting-group { margin-bottom: 24px; }
        .setting-group:last-child { margin-bottom: 0; }
        .setting-label { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-dim); margin-bottom: 8px; }
        .input-row { display: flex; gap: 10px; }
        .input-field { flex: 1; background: var(--bg-surface); border: 1px solid var(--border); border-radius: 8px; padding: 12px 16px; font-family: 'Space Mono', monospace; font-size: 13px; color: var(--text); outline: none; transition: border-color 0.2s; }
        .input-field:focus { border-color: var(--accent); }
        .input-field::placeholder { color: var(--text-dim); opacity: 0.5; }

        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 100px; font-size: 12px; font-weight: 600; }
        .status-badge.connected { background: rgba(0, 229, 160, 0.1); color: var(--accent-secondary); border: 1px solid rgba(0, 229, 160, 0.2); }
        .status-badge.disconnected { background: rgba(255, 77, 106, 0.1); color: var(--accent); border: 1px solid rgba(255, 77, 106, 0.2); }

        .rd-auth-box { background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 24px; text-align: center; display: none; }
        .rd-auth-box.visible { display: block; }
        .rd-user-code { font-family: 'Space Mono', monospace; font-size: 32px; font-weight: 700; letter-spacing: 6px; color: var(--accent); margin: 16px 0; }
        .rd-auth-box p { font-size: 14px; color: var(--text-dim); line-height: 1.6; }
        .rd-auth-box a { color: var(--accent-secondary); text-decoration: none; }
        .rd-auth-box a:hover { text-decoration: underline; }
        .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid var(--border); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .rd-user-info { display: none; align-items: center; gap: 16px; background: var(--bg-surface); border: 1px solid rgba(0, 229, 160, 0.15); border-radius: var(--radius); padding: 16px 20px; }
        .rd-user-info.visible { display: flex; }
        .rd-user-info .user-details { flex: 1; }
        .rd-user-info .user-name { font-weight: 600; font-size: 15px; }
        .rd-user-info .user-meta { font-size: 12px; color: var(--text-dim); }

        /* Anime list */
        .anime-section { margin: 40px 0; }
        .anime-section h2 { font-size: 22px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }
        .anime-list { display: flex; flex-direction: column; gap: 8px; }
        .anime-item { display: flex; align-items: center; gap: 14px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 10px; padding: 12px 16px; transition: all 0.2s; }
        .anime-item.hidden-anime { opacity: 0.4; }
        .anime-item:hover { border-color: rgba(255,255,255,0.1); }
        .anime-poster { width: 45px; height: 65px; border-radius: 6px; object-fit: cover; flex-shrink: 0; background: var(--bg-surface); }
        .anime-info { flex: 1; min-width: 0; }
        .anime-title { font-size: 14px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .anime-meta { font-size: 12px; color: var(--text-dim); margin-top: 2px; }
        .anime-ep { color: var(--accent); font-weight: 600; }
        .toggle-btn { width: 44px; height: 26px; border-radius: 13px; border: none; cursor: pointer; position: relative; transition: background 0.2s; flex-shrink: 0; }
        .toggle-btn.on { background: var(--accent-secondary); }
        .toggle-btn.off { background: #333; }
        .toggle-btn::after { content: ''; position: absolute; width: 20px; height: 20px; border-radius: 50%; background: white; top: 3px; transition: left 0.2s; }
        .toggle-btn.on::after { left: 21px; }
        .toggle-btn.off::after { left: 3px; }

        .anime-empty { text-align: center; padding: 40px; color: var(--text-dim); font-size: 14px; }

        .footer { text-align: center; padding: 40px 0; color: var(--text-dim); font-size: 13px; border-top: 1px solid var(--border); margin-top: 60px; }
        .footer a { color: var(--accent); text-decoration: none; }

        .toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius); padding: 14px 24px; font-size: 14px; z-index: 100; transition: transform 0.3s ease; pointer-events: none; }
        .toast.show { transform: translateX(-50%) translateY(0); }

        .hint { font-size: 12px; color: var(--text-dim); margin-top: 6px; font-style: italic; }

        @media (max-width: 640px) {
            .container { padding: 24px 16px; }
            .cards { grid-template-columns: 1fr; }
            .install-row { flex-direction: column; align-items: center; }
            .input-row { flex-direction: column; }
            .rd-user-info { flex-direction: column; text-align: center; }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>

    <div class="container">
        <header class="header">
            <div class="logo-badge"><span class="dot"></span> Stremio Addon v4.0</div>
            <h1><span class="accent">Anime</span> Today<span class="green">.</span></h1>
            <p class="tagline">Dne≈°n√≠ anime epizody z AniList. Torrenty z Nyaa.si + Sukebei. Streaming p≈ôes RealDebrid.</p>
            <div class="install-row">
                <a href="stremio://animetoday.duckdns.org/manifest.json" class="btn btn-primary">üöÄ Instalovat do Stremio</a>
                <button class="btn btn-secondary" onclick="copyManifest()">üìã Kop√≠rovat URL</button>
            </div>
            <div class="manifest-url" onclick="copyManifest()" title="Kliknƒõte pro zkop√≠rov√°n√≠">
                <span>https://animetoday.duckdns.org/manifest.json</span> üìã
            </div>
        </header>

        <div class="cards">
            <div class="card"><div class="card-icon">üì°</div><h3>AniList denn√≠ program</h3><p>Automaticky stahuje dne≈°n√≠ anime. Aktualizace ka≈æd√Ω den ve 4:00 + co 6 hodin.</p></div>
            <div class="card"><div class="card-icon">üîç</div><h3>Nyaa.si + Sukebei</h3><p>Hled√° torrenty na Nyaa.si, fallback na Sukebei. Chytr√Ω matching epizod.</p></div>
            <div class="card"><div class="card-icon">‚ö°</div><h3>RealDebrid</h3><p>P≈ôihlaste se zde ‚Äî kl√≠ƒç se ulo≈æ√≠ na server. Stremio streamuje automaticky.</p></div>
        </div>

        <!-- RealDebrid -->
        <section class="settings-section">
            <h2>‚ö° RealDebrid</h2>
            <p class="desc">P≈ôihlaste se ke sv√©mu RD √∫ƒçtu. Kl√≠ƒç se ulo≈æ√≠ na server ‚Äî Stremio ho pou≈æije automaticky.</p>

            <div class="setting-group">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                    <span class="setting-label" style="margin:0">Stav</span>
                    <span id="rd-status" class="status-badge disconnected">‚¨§ Nep≈ôipojen</span>
                </div>
                <div id="rd-user-info" class="rd-user-info">
                    <div class="user-details">
                        <div class="user-name" id="rd-username">‚Äî</div>
                        <div class="user-meta" id="rd-user-meta">‚Äî</div>
                    </div>
                    <button class="btn btn-small btn-danger" onclick="disconnectRD()">Odpojit</button>
                </div>
            </div>

            <div id="rd-login-options">
                <div class="setting-group">
                    <div class="setting-label">OAuth p≈ôihl√°≈°en√≠ (doporuƒçeno)</div>
                    <button id="rd-oauth-btn" class="btn btn-primary btn-small" onclick="startRDAuth()">üîê P≈ôihl√°sit p≈ôes RealDebrid</button>
                </div>
                <div id="rd-auth-box" class="rd-auth-box">
                    <p>P≈ôejdƒõte na:</p>
                    <div><a id="rd-verify-url" href="https://real-debrid.com/device" target="_blank">real-debrid.com/device</a></div>
                    <div class="rd-user-code" id="rd-user-code">------</div>
                    <p><span class="spinner"></span> ƒåek√°m na ovƒõ≈ôen√≠...</p>
                </div>
                <div class="setting-group" style="margin-top:20px">
                    <div class="setting-label">Nebo: API kl√≠ƒç manu√°lnƒõ</div>
                    <div class="input-row">
                        <input type="password" id="rd-api-key" class="input-field" placeholder="API kl√≠ƒç z real-debrid.com/apitoken" autocomplete="off">
                        <button class="btn btn-small btn-secondary" onclick="saveRDKey()">Ulo≈æit</button>
                    </div>
                    <p class="hint">Kl√≠ƒç z√≠sk√°te na <a href="https://real-debrid.com/apitoken" target="_blank" style="color:var(--accent-secondary)">real-debrid.com/apitoken</a></p>
                </div>
            </div>
        </section>

        <!-- TMDB -->
        <section class="settings-section">
            <h2>üñºÔ∏è TMDB</h2>
            <p class="desc">Voliteln√©. Pro lep≈°√≠ postery a pozad√≠. Kl√≠ƒç se ulo≈æ√≠ na server.</p>
            <div class="setting-group">
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <span class="setting-label" style="margin:0">Stav</span>
                    <span id="tmdb-status" class="status-badge disconnected">‚¨§ Nenastaveno</span>
                </div>
                <div class="input-row">
                    <input type="text" id="tmdb-api-key" class="input-field" placeholder="TMDB API kl√≠ƒç (v3 auth)" autocomplete="off">
                    <button class="btn btn-small btn-secondary" onclick="saveTMDBKey()">Ulo≈æit</button>
                </div>
            </div>
        </section>

        <!-- Anime filter -->
        <section class="anime-section">
            <h2>üì∫ Dne≈°n√≠ anime <span style="font-size:14px;color:var(--text-dim);font-weight:400" id="anime-count"></span></h2>
            <p style="color:var(--text-dim);font-size:14px;margin-bottom:16px">
                Vypnƒõte anime kter√© nechcete ve Stremio. Volba se pamatuje ‚Äî p≈ô√≠≈°t√≠ t√Ωden bude stejn√© anime automaticky skryt√©.
            </p>
            <div id="anime-list" class="anime-list">
                <div class="anime-empty">Naƒç√≠t√°m...</div>
            </div>
        </section>

        <footer class="footer">
            <p>Anime Today v4.0 ¬∑ <a href="https://github.com/david325345/animetoday" target="_blank">GitHub</a> ¬∑ Data z <a href="https://anilist.co" target="_blank">AniList</a>, <a href="https://nyaa.si" target="_blank">Nyaa.si</a>, <a href="https://www.themoviedb.org" target="_blank">TMDB</a></p>
        </footer>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        function showToast(msg, duration = 3000) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), duration);
        }

        function copyManifest() {
            navigator.clipboard.writeText('https://animetoday.duckdns.org/manifest.json')
                .then(() => showToast('‚úÖ URL zkop√≠rov√°na!'))
                .catch(() => showToast('‚ùå Kop√≠rov√°n√≠ selhalo'));
        }

        // ===== RealDebrid =====
        async function checkRDStatus() {
            try {
                const resp = await fetch('/api/rd/status');
                const data = await resp.json();
                if (data.connected) {
                    updateRDUI('connected', data);
                } else {
                    updateRDUI('disconnected');
                }
            } catch { updateRDUI('disconnected'); }
        }

        function updateRDUI(status, data) {
            const statusEl = document.getElementById('rd-status');
            const userInfo = document.getElementById('rd-user-info');
            const loginOpts = document.getElementById('rd-login-options');

            if (status === 'connected') {
                statusEl.className = 'status-badge connected';
                statusEl.textContent = '‚¨§ P≈ôipojeno';
                userInfo.classList.add('visible');
                loginOpts.style.display = 'none';
                document.getElementById('rd-username').textContent = data?.username || 'RealDebrid User';
                const premium = data?.premium ? '‚≠ê Premium' : 'Free';
                const expiry = data?.expiration ? ` ¬∑ do ${new Date(data.expiration).toLocaleDateString('cs')}` : '';
                document.getElementById('rd-user-meta').textContent = `${premium}${expiry}`;
            } else {
                statusEl.className = 'status-badge disconnected';
                statusEl.textContent = '‚¨§ Nep≈ôipojen';
                userInfo.classList.remove('visible');
                loginOpts.style.display = 'block';
            }
        }

        async function startRDAuth() {
            const btn = document.getElementById('rd-oauth-btn');
            const authBox = document.getElementById('rd-auth-box');
            btn.disabled = true; btn.textContent = '‚è≥ P≈ôipravuji...';

            try {
                const resp = await fetch('/api/rd/device-code');
                const data = await resp.json();
                if (data.error) { showToast('‚ùå ' + data.error); btn.disabled = false; btn.textContent = 'üîê P≈ôihl√°sit p≈ôes RealDebrid'; return; }

                document.getElementById('rd-user-code').textContent = data.user_code;
                document.getElementById('rd-verify-url').href = data.verification_url;
                authBox.classList.add('visible');
                btn.style.display = 'none';

                const interval = (data.interval || 5) * 1000;
                const maxAttempts = Math.floor((data.expires_in || 600) / (data.interval || 5));
                let attempts = 0;

                const timer = setInterval(async () => {
                    attempts++;
                    if (attempts > maxAttempts) {
                        clearInterval(timer);
                        authBox.classList.remove('visible');
                        btn.style.display = ''; btn.disabled = false; btn.textContent = 'üîê P≈ôihl√°sit p≈ôes RealDebrid';
                        showToast('‚è∞ ƒåas vypr≈°el');
                        return;
                    }
                    try {
                        const pollResp = await fetch(`/api/rd/poll-auth?device_code=${data.device_code}`);
                        const pollData = await pollResp.json();
                        if (pollData.status === 'authorized') {
                            clearInterval(timer);
                            authBox.classList.remove('visible');
                            btn.style.display = ''; btn.disabled = false; btn.textContent = 'üîê P≈ôihl√°sit p≈ôes RealDebrid';
                            showToast('‚úÖ RealDebrid p≈ôipojeno!');
                            checkRDStatus();
                        }
                    } catch {}
                }, interval);
            } catch (err) {
                showToast('‚ùå ' + err.message);
                btn.disabled = false; btn.textContent = 'üîê P≈ôihl√°sit p≈ôes RealDebrid';
            }
        }

        async function saveRDKey() {
            const key = document.getElementById('rd-api-key').value.trim();
            if (!key) { showToast('‚ùå Zadejte API kl√≠ƒç'); return; }
            try {
                const resp = await fetch('/api/rd/save-key', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key })
                });
                const data = await resp.json();
                if (data.success) {
                    document.getElementById('rd-api-key').value = '';
                    showToast('‚úÖ RealDebrid kl√≠ƒç ulo≈æen!');
                    checkRDStatus();
                } else {
                    showToast('‚ùå Neplatn√Ω kl√≠ƒç: ' + (data.error || ''));
                }
            } catch { showToast('‚ùå Chyba'); }
        }

        async function disconnectRD() {
            await fetch('/api/rd/disconnect', { method: 'POST' });
            updateRDUI('disconnected');
            showToast('üîå RealDebrid odpojen');
        }

        // ===== TMDB =====
        async function checkTMDBStatus() {
            try {
                const resp = await fetch('/api/tmdb/status');
                const data = await resp.json();
                const el = document.getElementById('tmdb-status');
                if (data.configured) { el.className = 'status-badge connected'; el.textContent = '‚¨§ Nastaveno'; }
            } catch {}
        }

        async function saveTMDBKey() {
            const key = document.getElementById('tmdb-api-key').value.trim();
            if (!key) { showToast('‚ùå Zadejte kl√≠ƒç'); return; }
            try {
                const resp = await fetch('/api/tmdb/save', {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ key })
                });
                const data = await resp.json();
                if (data.valid && data.saved) {
                    document.getElementById('tmdb-api-key').value = '';
                    document.getElementById('tmdb-status').className = 'status-badge connected';
                    document.getElementById('tmdb-status').textContent = '‚¨§ Nastaveno';
                    showToast('‚úÖ TMDB kl√≠ƒç ulo≈æen!');
                } else { showToast('‚ùå Neplatn√Ω TMDB kl√≠ƒç'); }
            } catch { showToast('‚ùå Chyba'); }
        }

        // ===== Anime list with hide/show =====
        async function loadAnime() {
            const list = document.getElementById('anime-list');
            const count = document.getElementById('anime-count');
            try {
                const resp = await fetch('/api/anime');
                const data = await resp.json();

                const visibleCount = data.anime.filter(a => !a.hidden).length;
                count.textContent = `(${visibleCount}/${data.count} zobrazeno)`;

                if (!data.anime?.length) {
                    list.innerHTML = '<div class="anime-empty">≈Ω√°dn√© anime pro dne≈°ek...</div>';
                    return;
                }

                list.innerHTML = data.anime.map(a => {
                    const title = a.title.romaji || a.title.english || a.title.native;
                    const poster = a.poster || '';
                    const isHidden = a.hidden;
                    const genres = (a.genres || []).slice(0, 3).join(', ');
                    const score = a.score ? `‚≠ê ${(a.score / 10).toFixed(1)}` : '';
                    const airTime = a.airingAt ? new Date(a.airingAt * 1000).toLocaleTimeString('cs-CZ', { timeZone: 'Europe/Prague', hour: '2-digit', minute: '2-digit', hour12: false }) : '';

                    return `
                        <div class="anime-item ${isHidden ? 'hidden-anime' : ''}" data-id="${a.id}">
                            ${poster ? `<img src="${poster}" class="anime-poster" loading="lazy" onerror="this.style.display='none'">` : '<div class="anime-poster"></div>'}
                            <div class="anime-info">
                                <div class="anime-title">${title}</div>
                                <div class="anime-meta">
                                    ${airTime ? `<span style="color:var(--accent)">üïê ${airTime}</span> ¬∑ ` : ''}
                                    <span class="anime-ep">EP ${a.episode}</span>
                                    ${genres ? ` ¬∑ ${genres}` : ''}
                                    ${score ? ` ¬∑ ${score}` : ''}
                                </div>
                            </div>
                            <button class="toggle-btn ${isHidden ? 'off' : 'on'}"
                                    onclick="toggleAnime(${a.id}, ${isHidden})"
                                    title="${isHidden ? 'Zobrazit ve Stremio' : 'Skr√Ωt ze Stremio'}">
                            </button>
                        </div>
                    `;
                }).join('');
            } catch {
                list.innerHTML = '<div class="anime-empty">Nepoda≈ôilo se naƒç√≠st</div>';
            }
        }

        async function toggleAnime(mediaId, currentlyHidden) {
            const endpoint = currentlyHidden ? '/api/anime/show' : '/api/anime/hide';
            try {
                await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ mediaId })
                });
                loadAnime();
                showToast(currentlyHidden ? 'üëÅÔ∏è Anime zobrazeno' : 'üôà Anime skryto');
            } catch { showToast('‚ùå Chyba'); }
        }

        // ===== Init =====
        document.addEventListener('DOMContentLoaded', () => {
            checkRDStatus();
            checkTMDBStatus();
            loadAnime();
            setInterval(loadAnime, 300000);
        });
    </script>
</body>
</html>
